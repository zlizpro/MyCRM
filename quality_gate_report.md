# MiniCRM UI组件代码质量检查报告

## 检查总结

- 总检查项: 5
- 通过检查: 1
- 失败检查: 4
- 通过率: 20.0%

🚨 **发现代码质量问题，需要立即修复！**

## 详细检查结果

### 文件大小检查 - ❌ 失败

- ⚠️  selection_manager.py: 152行 (建议拆分)
- ✅ cell_formatter.py: 135行
- ❌ base_panel.py: 552行 (超过200行限制)
- ❌ base_widget.py: 332行 (超过200行限制)
- ❌ form_validator.py: 403行 (超过200行限制)
- ❌ loading_widget.py: 471行 (超过200行限制)
- ❌ form_data_binder.py: 343行 (超过200行限制)
- ❌ base_dialog.py: 502行 (超过200行限制)
- ❌ search_history_manager.py: 282行 (超过200行限制)
- ❌ form_field_factory.py: 324行 (超过200行限制)
- ❌ search_filter_manager.py: 396行 (超过200行限制)
- ❌ dashboard_refactored.py: 463行 (超过200行限制)
- ❌ search_bar_core.py: 282行 (超过200行限制)
- ❌ form_panel_core.py: 327行 (超过200行限制)
- ❌ search_bar_simplified.py: 351行 (超过200行限制)
- ✅ search_styles.py: 118行
- ❌ table_filter_manager.py: 466行 (超过200行限制)
- ❌ notification_widget.py: 626行 (超过200行限制)
- ❌ search_bar_old.py: 371行 (超过200行限制)
- ❌ table_pagination_manager.py: 472行 (超过200行限制)
- ❌ dashboard.py: 531行 (超过200行限制)
- ❌ pagination_widget.py: 653行 (超过200行限制)
- ❌ navigation_panel.py: 587行 (超过200行限制)
- ✅ form_panel.py: 23行
- ✅ data_table.py: 24行
- ❌ table_data_manager.py: 448行 (超过200行限制)
- ⚠️  search_bar.py: 161行 (建议拆分)
- ❌ metric_card.py: 480行 (超过200行限制)
- ❌ chart_widget.py: 641行 (超过200行限制)
- ❌ search_widget.py: 658行 (超过200行限制)
- ❌ search_config.py: 237行 (超过200行限制)
- ✅ dashboard_refactored.py: 11行
- ✅ dashboard_refactored_utils.py: 11行
- ✅ dashboard_refactored_manager.py: 11行
- ✅ form_field_factory.py: 11行
- ✅ form_field_factory_manager.py: 11行
- ✅ form_field_factory_utils.py: 11行
- ✅ form_validator.py: 11行
- ✅ form_data_binder.py: 11行
- ❌ form_field_factory.py: 293行 (超过200行限制)
- ✅ field_factory.py: 11行
- ✅ form_panel.py: 11行
- ✅ form_styles.py: 11行
- ✅ form_layout_manager.py: 11行
- ✅ base_panel.py: 11行
- ✅ base_panel_utils.py: 11行
- ✅ base_panel_manager.py: 11行
- ✅ search_bar_old_utils.py: 11行
- ✅ search_bar_old_manager.py: 11行
- ✅ search_bar_old.py: 11行
- ✅ form_validator.py: 11行
- ✅ form_validator_utils.py: 11行
- ✅ form_validator_manager.py: 11行
- ✅ metric_card_manager.py: 11行
- ✅ metric_card_utils.py: 11行
- ✅ metric_card.py: 11行
- ✅ search_bar_core_manager.py: 11行
- ✅ search_bar_core.py: 11行
- ✅ search_bar_core_utils.py: 11行
- ✅ base_dialog.py: 11行
- ✅ base_dialog_manager.py: 11行
- ✅ base_dialog_utils.py: 11行
- ✅ table_pagination_manager.py: 11行
- ✅ table_pagination_manager_utils.py: 11行
- ✅ table_pagination_manager_manager.py: 11行
- ✅ search_bar_simplified_utils.py: 11行
- ✅ search_bar_simplified.py: 11行
- ✅ search_bar_simplified_manager.py: 11行
- ✅ search_history_manager.py: 11行
- ✅ search_filter_manager.py: 11行
- ✅ search_widget.py: 11行
- ✅ search_config.py: 11行
- ✅ dashboard_manager.py: 11行
- ✅ dashboard.py: 11行
- ✅ dashboard_utils.py: 11行
- ❌ table_filter_manager.py: 217行 (超过200行限制)
- ⚠️  table_pagination_manager.py: 158行 (建议拆分)
- ✅ table_export_manager.py: 95行
- ❌ data_table.py: 381行 (超过200行限制)
- ❌ table_data_manager.py: 247行 (超过200行限制)
- ✅ search_config_utils.py: 11行
- ✅ search_config_manager.py: 11行
- ✅ search_config.py: 11行
- ✅ table_filter_manager_manager.py: 11行
- ✅ table_filter_manager.py: 11行
- ✅ table_filter_manager_utils.py: 11行
- ✅ chart_widget_manager.py: 11行
- ✅ chart_widget_utils.py: 11行
- ✅ chart_widget.py: 11行
- ✅ navigation_panel_utils.py: 11行
- ✅ navigation_panel_manager.py: 11行
- ✅ navigation_panel.py: 11行
- ✅ pagination_widget_manager.py: 11行
- ✅ pagination_widget_utils.py: 11行
- ✅ pagination_widget.py: 11行
- ✅ form_data_binder.py: 11行
- ✅ form_data_binder_utils.py: 11行
- ✅ form_data_binder_manager.py: 11行
- ✅ base_widget.py: 11行
- ✅ base_widget_utils.py: 11行
- ✅ base_widget_manager.py: 11行
- ✅ notification_widget_utils.py: 11行
- ✅ notification_widget.py: 11行
- ✅ notification_widget_manager.py: 11行
- ✅ table_data_manager_utils.py: 11行
- ✅ table_data_manager_manager.py: 11行
- ✅ table_data_manager.py: 11行
- ✅ loading_widget_utils.py: 11行
- ✅ loading_widget_manager.py: 11行
- ✅ loading_widget.py: 11行
- ✅ search_filter_manager.py: 11行
- ✅ search_filter_manager_manager.py: 11行
- ✅ search_filter_manager_utils.py: 11行
- ✅ search_history_manager.py: 11行
- ✅ search_history_manager_utils.py: 11行
- ✅ search_history_manager_manager.py: 11行

### 导入语句检查 - ✅ 通过

- ✅ cell_formatter.py: 有typing导入
- ✅ base_widget.py: 有typing导入
- ✅ form_validator.py: 有typing导入
- ✅ form_data_binder.py: 有typing导入
- ✅ base_dialog.py: 有typing导入
- ✅ search_history_manager.py: 有typing导入
- ✅ form_field_factory.py: 有typing导入
- ✅ search_filter_manager.py: 有typing导入
- ✅ dashboard_refactored.py: 有typing导入
- ✅ search_bar_core.py: 有typing导入
- ✅ form_panel_core.py: 有typing导入
- ✅ search_bar_simplified.py: 有typing导入
- ✅ table_filter_manager.py: 有typing导入
- ✅ search_bar_old.py: 有typing导入
- ✅ table_pagination_manager.py: 有typing导入
- ✅ dashboard.py: 有typing导入
- ✅ table_data_manager.py: 有typing导入
- ✅ search_bar.py: 有typing导入
- ✅ metric_card.py: 有typing导入
- ✅ chart_widget.py: 有typing导入
- ✅ search_widget.py: 有typing导入
- ✅ search_config.py: 有typing导入
- ✅ form_field_factory.py: 有typing导入
- ✅ table_filter_manager.py: 有typing导入
- ✅ table_export_manager.py: 有typing导入
- ✅ data_table.py: 有typing导入
- ✅ table_data_manager.py: 有typing导入

### Ruff代码检查 - ❌ 失败

- ❌ base_dialog.py:425 [SIM102] Use a single `if` statement instead of nested `if` statements
- ❌ base_dialog.py:490 [N802] Function name `closeEvent` should be lowercase
- ❌ base_dialog.py:492 [SIM102] Use a single `if` statement instead of nested `if` statements
- ❌ base_panel.py:348 [F821] Undefined name `e`
- ❌ base_panel.py:545 [N802] Function name `closeEvent` should be lowercase
- ❌ base_panel.py:552 [E501] Line too long (98 > 88)
- ❌ base_widget.py:325 [N802] Function name `closeEvent` should be lowercase
- ❌ chart_widget.py:468 [SIM102] Use a single `if` statement instead of nested `if` statements
- ❌ chart_widget.py:641 [E501] Line too long (112 > 88)
- ❌ dashboard.py:528 [N802] Function name `closeEvent` should be lowercase
- ❌ form_data_binder.py:202 [SIM101] Multiple `isinstance` calls for `widget`, merge into a single call
- ❌ form_field_factory.py:270 [E501] Line too long (141 > 88)
- ❌ form_field_factory.py:296 [SIM102] Use a single `if` statement instead of nested `if` statements
- ❌ form_validator.py:44 [E501] Line too long (97 > 88)
- ❌ form_validator.py:302 [SIM103] Return the condition `not (max_val is not None and num_value > max_val)` directly
- ❌ loading_widget.py:75 [N802] Function name `paintEvent` should be lowercase
- ❌ loading_widget.py:286 [SIM108] Use ternary operator `parent_rect = parent.rect() if hasattr(parent, "rect") else self.rect()` instead of `if`-`else`-block
- ❌ loading_widget.py:393 [N802] Function name `paintEvent` should be lowercase
- ❌ metric_card.py:439 [N802] Function name `mousePressEvent` should be lowercase
- ❌ metric_card.py:445 [N802] Function name `enterEvent` should be lowercase
- ❌ metric_card.py:453 [N802] Function name `leaveEvent` should be lowercase
- ❌ metric_card.py:461 [N802] Function name `paintEvent` should be lowercase
- ❌ navigation_panel.py:17 [invalid-syntax] Expected one or more symbol names after import
- ❌ navigation_panel.py:19 [invalid-syntax] Unexpected indentation
- ❌ navigation_panel.py:26 [invalid-syntax] Expected a statement
- ❌ navigation_panel.py:26 [invalid-syntax] Expected a statement
- ❌ notification_widget.py:372 [N802] Function name `enterEvent` should be lowercase
- ❌ notification_widget.py:377 [N802] Function name `leaveEvent` should be lowercase
- ❌ notification_widget.py:518 [SIM108] Use ternary operator `parent_rect = parent.rect() if hasattr(parent, "rect") else self.rect()` instead of `if`-`else`-block
- ❌ pagination_widget.py:475 [PERF401] Use `list.extend` to create a transformed list
- ❌ pagination_widget.py:653 [E501] Line too long (132 > 88)
- ❌ search_history_manager.py:282 [E501] Line too long (113 > 88)
- ❌ search_widget.py:658 [E501] Line too long (104 > 88)
- ❌ data_table.py:7 [invalid-syntax] Expected one or more symbol names after import
- ❌ data_table.py:9 [invalid-syntax] Unexpected indentation
- ❌ data_table.py:20 [invalid-syntax] Expected a statement
- ❌ data_table.py:20 [invalid-syntax] Expected a statement
- ❌ table_export_manager.py:55 [E501] Line too long (96 > 88)
- ❌ table_pagination_manager.py:96 [E501] Line too long (99 > 88)

### MyPy类型检查 - ❌ 失败

- ❌ src/minicrm/ui/components/table/data_table.py:8:2: error: Invalid syntax

### Transfunctions使用检查 - ❌ 失败

- 🔍 开始检查transfunctions使用情况...
- 📂 扫描目录: src/minicrm/ui/components
- 
- 📄 cell_formatter.py
-    🔍 发现 9 个重复实现的函数
-    💡 修复建议:
-       🔄 替换重复实现的函数:
-          第124行: format_cell_value()
-             → 使用 transfunctions.formatting.format_currency
-               理由: 格式化函数应使用transfunctions.formatting.format_currency
-             → 使用 transfunctions.formatting.format_phone
-               理由: 格式化函数应使用transfunctions.formatting.format_phone
-             → 使用 transfunctions.formatting.format_date
-               理由: 格式化函数应使用transfunctions.formatting.format_date
-             → 使用 transfunctions.formatting.format_address
-               理由: 格式化函数应使用transfunctions.formatting.format_address
-             → 使用 transfunctions.formatting.format_percentage
-               理由: 格式化函数应使用transfunctions.formatting.format_percentage
-             → 使用 transfunctions.formatting.format_number
-               理由: 格式化函数应使用transfunctions.formatting.format_number
-          第44行: format_value()
-             → 使用 transfunctions.formatting.format_currency
-               理由: 格式化函数应使用transfunctions.formatting.format_currency
-             → 使用 transfunctions.formatting.format_phone
-               理由: 格式化函数应使用transfunctions.formatting.format_phone
-             → 使用 transfunctions.formatting.format_date
-               理由: 格式化函数应使用transfunctions.formatting.format_date
-             → 使用 transfunctions.formatting.format_address
-               理由: 格式化函数应使用transfunctions.formatting.format_address
-             → 使用 transfunctions.formatting.format_percentage
-               理由: 格式化函数应使用transfunctions.formatting.format_percentage
-             → 使用 transfunctions.formatting.format_number
-               理由: 格式化函数应使用transfunctions.formatting.format_number
-          第68行: _format_currency()
-             → 使用 transfunctions.formatting.format_currency
-               理由: 格式化函数应使用transfunctions.formatting.format_currency
-          第82行: _format_percentage()
-             → 使用 transfunctions.formatting.format_percentage
-               理由: 格式化函数应使用transfunctions.formatting.format_percentage
-          第89行: _format_date()
-             → 使用 transfunctions.formatting.format_date
-               理由: 格式化函数应使用transfunctions.formatting.format_date
-          第98行: _format_datetime()
-             → 使用 transfunctions.formatting.format_currency
-               理由: 格式化函数应使用transfunctions.formatting.format_currency
-             → 使用 transfunctions.formatting.format_phone
-               理由: 格式化函数应使用transfunctions.formatting.format_phone
-             → 使用 transfunctions.formatting.format_date
-               理由: 格式化函数应使用transfunctions.formatting.format_date
-             → 使用 transfunctions.formatting.format_address
-               理由: 格式化函数应使用transfunctions.formatting.format_address
-             → 使用 transfunctions.formatting.format_percentage
-               理由: 格式化函数应使用transfunctions.formatting.format_percentage
-             → 使用 transfunctions.formatting.format_number
-               理由: 格式化函数应使用transfunctions.formatting.format_number
-          第104行: _format_phone()
-             → 使用 transfunctions.formatting.format_phone
-               理由: 格式化函数应使用transfunctions.formatting.format_phone
-          第111行: _format_boolean()
-             → 使用 transfunctions.formatting.format_currency
-               理由: 格式化函数应使用transfunctions.formatting.format_currency
-             → 使用 transfunctions.formatting.format_phone
-               理由: 格式化函数应使用transfunctions.formatting.format_phone
-             → 使用 transfunctions.formatting.format_date
-               理由: 格式化函数应使用transfunctions.formatting.format_date
-             → 使用 transfunctions.formatting.format_address
-               理由: 格式化函数应使用transfunctions.formatting.format_address
-             → 使用 transfunctions.formatting.format_percentage
-               理由: 格式化函数应使用transfunctions.formatting.format_percentage
-             → 使用 transfunctions.formatting.format_number
-               理由: 格式化函数应使用transfunctions.formatting.format_number
-          第115行: _format_text()
-             → 使用 transfunctions.formatting.format_currency
-               理由: 格式化函数应使用transfunctions.formatting.format_currency
-             → 使用 transfunctions.formatting.format_phone
-               理由: 格式化函数应使用transfunctions.formatting.format_phone
-             → 使用 transfunctions.formatting.format_date
-               理由: 格式化函数应使用transfunctions.formatting.format_date
-             → 使用 transfunctions.formatting.format_address
-               理由: 格式化函数应使用transfunctions.formatting.format_address
-             → 使用 transfunctions.formatting.format_percentage
-               理由: 格式化函数应使用transfunctions.formatting.format_percentage
-             → 使用 transfunctions.formatting.format_number
-               理由: 格式化函数应使用transfunctions.formatting.format_number
- 
- 📄 form_validator.py
-    🔍 发现 2 个重复实现的函数
-    💡 修复建议:
-       🔄 替换重复实现的函数:
-          第99行: validate_field()
-             → 使用 transfunctions.validation.validate_customer_data
-               理由: 验证函数应使用transfunctions.validation.validate_customer_data
-             → 使用 transfunctions.validation.validate_supplier_data
-               理由: 验证函数应使用transfunctions.validation.validate_supplier_data
-             → 使用 transfunctions.validation.validate_email
-               理由: 验证函数应使用transfunctions.validation.validate_email
-             → 使用 transfunctions.validation.validate_phone
-               理由: 验证函数应使用transfunctions.validation.validate_phone
-             → 使用 transfunctions.validation.validate_required_fields
-               理由: 验证函数应使用transfunctions.validation.validate_required_fields
-             → 使用 transfunctions.validation.validate_data_types
-               理由: 验证函数应使用transfunctions.validation.validate_data_types
-          第132行: validate_form()
-             → 使用 transfunctions.validation.validate_customer_data
-               理由: 验证函数应使用transfunctions.validation.validate_customer_data
-             → 使用 transfunctions.validation.validate_supplier_data
-               理由: 验证函数应使用transfunctions.validation.validate_supplier_data
-             → 使用 transfunctions.validation.validate_email
-               理由: 验证函数应使用transfunctions.validation.validate_email
-             → 使用 transfunctions.validation.validate_phone
-               理由: 验证函数应使用transfunctions.validation.validate_phone
-             → 使用 transfunctions.validation.validate_required_fields
-               理由: 验证函数应使用transfunctions.validation.validate_required_fields
-             → 使用 transfunctions.validation.validate_data_types
-               理由: 验证函数应使用transfunctions.validation.validate_data_types
- 
- 📄 base_dialog.py
-    🔍 发现 1 个重复实现的函数
-    ⚠️  缺少transfunctions导入
-    💡 修复建议:
-       📥 添加缺失的导入:
-          from transfunctions.validation import *
-       🔄 替换重复实现的函数:
-          第368行: validate_data()
-             → 使用 transfunctions.validation.validate_customer_data
-               理由: 验证函数应使用transfunctions.validation.validate_customer_data
-             → 使用 transfunctions.validation.validate_supplier_data
-               理由: 验证函数应使用transfunctions.validation.validate_supplier_data
-             → 使用 transfunctions.validation.validate_email
-               理由: 验证函数应使用transfunctions.validation.validate_email
-             → 使用 transfunctions.validation.validate_phone
-               理由: 验证函数应使用transfunctions.validation.validate_phone
-             → 使用 transfunctions.validation.validate_required_fields
-               理由: 验证函数应使用transfunctions.validation.validate_required_fields
-             → 使用 transfunctions.validation.validate_data_types
-               理由: 验证函数应使用transfunctions.validation.validate_data_types
- 
- 📄 dashboard_refactored.py
-    🔍 发现 2 个重复实现的函数
-    ⚠️  缺少transfunctions导入
-    💡 修复建议:
-       📥 添加缺失的导入:
-          from transfunctions.formatting import *
-       🔄 替换重复实现的函数:
-          第388行: _format_metric_title()
-             → 使用 transfunctions.formatting.format_currency
-               理由: 格式化函数应使用transfunctions.formatting.format_currency
-             → 使用 transfunctions.formatting.format_phone
-               理由: 格式化函数应使用transfunctions.formatting.format_phone
-             → 使用 transfunctions.formatting.format_date
-               理由: 格式化函数应使用transfunctions.formatting.format_date
-             → 使用 transfunctions.formatting.format_address
-               理由: 格式化函数应使用transfunctions.formatting.format_address
-             → 使用 transfunctions.formatting.format_percentage
-               理由: 格式化函数应使用transfunctions.formatting.format_percentage
-             → 使用 transfunctions.formatting.format_number
-               理由: 格式化函数应使用transfunctions.formatting.format_number
-          第399行: _format_chart_title()
-             → 使用 transfunctions.formatting.format_currency
-               理由: 格式化函数应使用transfunctions.formatting.format_currency
-             → 使用 transfunctions.formatting.format_phone
-               理由: 格式化函数应使用transfunctions.formatting.format_phone
-             → 使用 transfunctions.formatting.format_date
-               理由: 格式化函数应使用transfunctions.formatting.format_date
-             → 使用 transfunctions.formatting.format_address
-               理由: 格式化函数应使用transfunctions.formatting.format_address
-             → 使用 transfunctions.formatting.format_percentage
-               理由: 格式化函数应使用transfunctions.formatting.format_percentage
-             → 使用 transfunctions.formatting.format_number
-               理由: 格式化函数应使用transfunctions.formatting.format_number
- 
- 📄 form_panel_core.py
-    🔍 发现 1 个重复实现的函数
-    ⚠️  缺少transfunctions导入
-    💡 修复建议:
-       📥 添加缺失的导入:
-          from transfunctions.validation import *
-       🔄 替换重复实现的函数:
-          第270行: validate_form()
-             → 使用 transfunctions.validation.validate_customer_data
-               理由: 验证函数应使用transfunctions.validation.validate_customer_data
-             → 使用 transfunctions.validation.validate_supplier_data
-               理由: 验证函数应使用transfunctions.validation.validate_supplier_data
-             → 使用 transfunctions.validation.validate_email
-               理由: 验证函数应使用transfunctions.validation.validate_email
-             → 使用 transfunctions.validation.validate_phone
-               理由: 验证函数应使用transfunctions.validation.validate_phone
-             → 使用 transfunctions.validation.validate_required_fields
-               理由: 验证函数应使用transfunctions.validation.validate_required_fields
-             → 使用 transfunctions.validation.validate_data_types
-               理由: 验证函数应使用transfunctions.validation.validate_data_types
- 
- 📄 table_pagination_manager.py
-    🔍 发现 1 个重复实现的函数
-    💡 修复建议:
-       🔄 替换重复实现的函数:
-          第187行: _calculate_total_pages()
-             → 使用 transfunctions.calculations.calculate_customer_value_score
-               理由: 计算函数应使用transfunctions.calculations.calculate_customer_value_score
-             → 使用 transfunctions.calculations.calculate_quote_total
-               理由: 计算函数应使用transfunctions.calculations.calculate_quote_total
-             → 使用 transfunctions.calculations.calculate_pagination
-               理由: 计算函数应使用transfunctions.calculations.calculate_pagination
-             → 使用 transfunctions.calculations.calculate_age
-               理由: 计算函数应使用transfunctions.calculations.calculate_age
-             → 使用 transfunctions.calculations.calculate_discount
-               理由: 计算函数应使用transfunctions.calculations.calculate_discount
- 
- 📄 pagination_widget.py
-    🔍 发现 2 个重复实现的函数
-    💡 修复建议:
-       🔄 替换重复实现的函数:
-          第338行: _calculate_total_pages()
-             → 使用 transfunctions.calculations.calculate_customer_value_score
-               理由: 计算函数应使用transfunctions.calculations.calculate_customer_value_score
-             → 使用 transfunctions.calculations.calculate_quote_total
-               理由: 计算函数应使用transfunctions.calculations.calculate_quote_total
-             → 使用 transfunctions.calculations.calculate_pagination
-               理由: 计算函数应使用transfunctions.calculations.calculate_pagination
-             → 使用 transfunctions.calculations.calculate_age
-               理由: 计算函数应使用transfunctions.calculations.calculate_age
-             → 使用 transfunctions.calculations.calculate_discount
-               理由: 计算函数应使用transfunctions.calculations.calculate_discount
-          第442行: _calculate_visible_pages()
-             → 使用 transfunctions.calculations.calculate_customer_value_score
-               理由: 计算函数应使用transfunctions.calculations.calculate_customer_value_score
-             → 使用 transfunctions.calculations.calculate_quote_total
-               理由: 计算函数应使用transfunctions.calculations.calculate_quote_total
-             → 使用 transfunctions.calculations.calculate_pagination
-               理由: 计算函数应使用transfunctions.calculations.calculate_pagination
-             → 使用 transfunctions.calculations.calculate_age
-               理由: 计算函数应使用transfunctions.calculations.calculate_age
-             → 使用 transfunctions.calculations.calculate_discount
-               理由: 计算函数应使用transfunctions.calculations.calculate_discount
- 
- ❌ 扫描文件 src/minicrm/ui/components/navigation_panel.py 时出错: invalid syntax (<unknown>, line 18)
- 📄 table_data_manager.py
-    🔍 发现 1 个重复实现的函数
-    ⚠️  缺少transfunctions导入
-    💡 修复建议:
-       📥 添加缺失的导入:
-          from transfunctions.formatting import *
-       🔄 替换重复实现的函数:
-          第273行: format_cell_value()
-             → 使用 transfunctions.formatting.format_currency
-               理由: 格式化函数应使用transfunctions.formatting.format_currency
-             → 使用 transfunctions.formatting.format_phone
-               理由: 格式化函数应使用transfunctions.formatting.format_phone
-             → 使用 transfunctions.formatting.format_date
-               理由: 格式化函数应使用transfunctions.formatting.format_date
-             → 使用 transfunctions.formatting.format_address
-               理由: 格式化函数应使用transfunctions.formatting.format_address
-             → 使用 transfunctions.formatting.format_percentage
-               理由: 格式化函数应使用transfunctions.formatting.format_percentage
-             → 使用 transfunctions.formatting.format_number
-               理由: 格式化函数应使用transfunctions.formatting.format_number
- 
- 📄 metric_card.py
-    🔍 发现 5 个重复实现的函数
-    💡 修复建议:
-       🔄 替换重复实现的函数:
-          第271行: _format_value()
-             → 使用 transfunctions.formatting.format_currency
-               理由: 格式化函数应使用transfunctions.formatting.format_currency
-             → 使用 transfunctions.formatting.format_phone
-               理由: 格式化函数应使用transfunctions.formatting.format_phone
-             → 使用 transfunctions.formatting.format_date
-               理由: 格式化函数应使用transfunctions.formatting.format_date
-             → 使用 transfunctions.formatting.format_address
-               理由: 格式化函数应使用transfunctions.formatting.format_address
-             → 使用 transfunctions.formatting.format_percentage
-               理由: 格式化函数应使用transfunctions.formatting.format_percentage
-             → 使用 transfunctions.formatting.format_number
-               理由: 格式化函数应使用transfunctions.formatting.format_number
-          第300行: _format_currency_value()
-             → 使用 transfunctions.formatting.format_currency
-               理由: 格式化函数应使用transfunctions.formatting.format_currency
-             → 使用 transfunctions.formatting.format_phone
-               理由: 格式化函数应使用transfunctions.formatting.format_phone
-             → 使用 transfunctions.formatting.format_date
-               理由: 格式化函数应使用transfunctions.formatting.format_date
-             → 使用 transfunctions.formatting.format_address
-               理由: 格式化函数应使用transfunctions.formatting.format_address
-             → 使用 transfunctions.formatting.format_percentage
-               理由: 格式化函数应使用transfunctions.formatting.format_percentage
-             → 使用 transfunctions.formatting.format_number
-               理由: 格式化函数应使用transfunctions.formatting.format_number
-          第315行: _format_percentage_value()
-             → 使用 transfunctions.formatting.format_currency
-               理由: 格式化函数应使用transfunctions.formatting.format_currency
-             → 使用 transfunctions.formatting.format_phone
-               理由: 格式化函数应使用transfunctions.formatting.format_phone
-             → 使用 transfunctions.formatting.format_date
-               理由: 格式化函数应使用transfunctions.formatting.format_date
-             → 使用 transfunctions.formatting.format_address
-               理由: 格式化函数应使用transfunctions.formatting.format_address
-             → 使用 transfunctions.formatting.format_percentage
-               理由: 格式化函数应使用transfunctions.formatting.format_percentage
-             → 使用 transfunctions.formatting.format_number
-               理由: 格式化函数应使用transfunctions.formatting.format_number
-          第325行: _format_rating_value()
-             → 使用 transfunctions.formatting.format_currency
-               理由: 格式化函数应使用transfunctions.formatting.format_currency
-             → 使用 transfunctions.formatting.format_phone
-               理由: 格式化函数应使用transfunctions.formatting.format_phone
-             → 使用 transfunctions.formatting.format_date
-               理由: 格式化函数应使用transfunctions.formatting.format_date
-             → 使用 transfunctions.formatting.format_address
-               理由: 格式化函数应使用transfunctions.formatting.format_address
-             → 使用 transfunctions.formatting.format_percentage
-               理由: 格式化函数应使用transfunctions.formatting.format_percentage
-             → 使用 transfunctions.formatting.format_number
-               理由: 格式化函数应使用transfunctions.formatting.format_number
-          第334行: _format_number_value()
-             → 使用 transfunctions.formatting.format_currency
-               理由: 格式化函数应使用transfunctions.formatting.format_currency
-             → 使用 transfunctions.formatting.format_phone
-               理由: 格式化函数应使用transfunctions.formatting.format_phone
-             → 使用 transfunctions.formatting.format_date
-               理由: 格式化函数应使用transfunctions.formatting.format_date
-             → 使用 transfunctions.formatting.format_address
-               理由: 格式化函数应使用transfunctions.formatting.format_address
-             → 使用 transfunctions.formatting.format_percentage
-               理由: 格式化函数应使用transfunctions.formatting.format_percentage
-             → 使用 transfunctions.formatting.format_number
-               理由: 格式化函数应使用transfunctions.formatting.format_number
- 
- ❌ 扫描文件 src/minicrm/ui/components/table/data_table.py 时出错: invalid syntax (<unknown>, line 8)
- 📄 table_data_manager.py
-    🔍 发现 1 个重复实现的函数
-    💡 修复建议:
-       🔄 替换重复实现的函数:
-          第151行: _format_cell_value()
-             → 使用 transfunctions.formatting.format_currency
-               理由: 格式化函数应使用transfunctions.formatting.format_currency
-             → 使用 transfunctions.formatting.format_phone
-               理由: 格式化函数应使用transfunctions.formatting.format_phone
-             → 使用 transfunctions.formatting.format_date
-               理由: 格式化函数应使用transfunctions.formatting.format_date
-             → 使用 transfunctions.formatting.format_address
-               理由: 格式化函数应使用transfunctions.formatting.format_address
-             → 使用 transfunctions.formatting.format_percentage
-               理由: 格式化函数应使用transfunctions.formatting.format_percentage
-             → 使用 transfunctions.formatting.format_number
-               理由: 格式化函数应使用transfunctions.formatting.format_number
- 
- 📊 检查总结:
-    - 检查文件: 116 个
-    - 有问题文件: 10 个
-    - 重复函数: 25 个
- 
- 🚨 发现 10 个文件违反transfunctions使用原则!
-    必须立即修复这些重复实现
- 
- 🎯 下一步:
-    1. 按照建议添加transfunctions导入
-    2. 删除重复实现的函数
-    3. 使用transfunctions中的对应函数
-    4. 运行测试确保功能正常
- ❌ 扫描文件 src/minicrm/ui/components/navigation_panel.py 时出错: invalid syntax (<unknown>, line 18)
- ❌ 扫描文件 src/minicrm/ui/components/table/data_table.py 时出错: invalid syntax (<unknown>, line 8)
- 
- 📄 详细报告已保存到: transfunctions_usage_report.md
- 

## 🛠️ 修复建议

### 文件大小检查

**修复方法:**
1. 运行 `python scripts/urgent_split_large_files.py`
2. 按照生成的重构指南拆分文件
3. 确保每个文件不超过200行

### Ruff代码检查

**修复方法:**
1. 运行 `uv run ruff check --fix src/minicrm/ui/components/`
2. 运行 `uv run ruff format src/minicrm/ui/components/`
3. 手动修复无法自动修复的问题

### MyPy类型检查

**修复方法:**
1. 运行 `python scripts/urgent_fix_qt_api.py`
2. 添加缺失的typing导入
3. 修复类型注解错误

### Transfunctions使用检查

**修复方法:**
1. 删除重复实现的函数
2. 使用transfunctions中的对应函数
3. 添加必要的导入语句
