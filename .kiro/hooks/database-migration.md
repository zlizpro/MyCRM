# 数据库迁移检查Hook

## Hook配置

**触发条件**: 当修改数据模型或数据库相关文件时
**执行频率**: 每次保存相关文件
**适用文件**: `models/*.py`, `data/migrations/*.py`, `data/database.py`

## Hook描述

这个hook会在您修改数据模型或数据库结构时，自动检查是否需要创建数据库迁移脚本，并验证数据库结构的一致性。

## 执行任务

1. **检测模型变更**
   - 分析保存的模型文件变更
   - 识别新增、修改或删除的字段
   - 检查表结构变化

2. **验证迁移需求**
   - 确定是否需要创建新的迁移脚本
   - 检查现有迁移脚本是否覆盖了变更
   - 验证迁移脚本的执行顺序

3. **数据库一致性检查**
   - 比较模型定义与实际数据库结构
   - 检查外键约束的正确性
   - 验证索引定义是否完整

4. **生成迁移建议**
   - 如果需要，提供迁移脚本模板
   - 建议数据迁移策略
   - 警告可能的数据丢失风险

## 检查项目

- **表结构变更**: 新增/删除表，修改列定义
- **约束变更**: 外键、唯一约束、检查约束
- **索引变更**: 新增/删除索引，复合索引
- **数据类型变更**: 可能影响现有数据的类型变更

## 输出格式

```
🗄️ 数据库迁移检查：

✅ 无需迁移 - 模型与数据库结构一致

或

⚠️ 检测到以下变更，建议创建迁移：

1. customers表：
   - 新增字段：cooperation_start_date (DATE)
   - 删除字段：email (VARCHAR)
   - 修改字段：phone (VARCHAR(20) -> VARCHAR(50))

2. 建议的迁移脚本：
```sql
ALTER TABLE customers ADD COLUMN cooperation_start_date DATE;
ALTER TABLE customers DROP COLUMN email;
ALTER TABLE customers MODIFY phone VARCHAR(50);
```

⚠️ 注意：删除email字段将导致数据丢失，请确认后执行
```
