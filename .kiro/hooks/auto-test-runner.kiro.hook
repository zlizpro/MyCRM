{
  "enabled": true,
  "name": "自动测试运行",
  "description": "当保存测试文件或被测试的源文件时自动运行相关的单元测试，确保代码更改不会破坏现有功能",
  "version": "1",
  "when": {
    "type": "fileEdited",
    "patterns": [
      "test_*.py",
      "*_test.py",
      "minicrm/services/*.py",
      "minicrm/data/dao/*.py",
      "minicrm/core/*.py",
      "minicrm/ui/components/*.py"
    ]
  },
  "then": {
    "type": "askAgent",
    "prompt": "请分析保存的文件并执行以下任务：\n\n1. **识别相关测试**\n   - 如果保存的是测试文件，运行该测试文件\n   - 如果保存的是源文件，查找并运行对应的测试文件\n   - 例如：保存`customer_service.py`时运行`test_customer_service.py`\n\n2. **运行测试**\n   - 使用pytest运行相关测试\n   - 捕获测试输出和结果\n   - 记录测试执行时间\n\n3. **分析测试结果**\n   - 统计通过/失败的测试数量\n   - 识别失败的具体测试用例\n   - 分析测试覆盖率（如果可用）\n\n4. **生成报告**\n   - 提供简洁的测试结果摘要\n   - 对于失败的测试，提供详细的错误信息\n   - 建议修复方案\n\n请使用以下格式输出结果：\n\n```\n🧪 测试运行结果：\n✅ 通过: X个测试\n❌ 失败: X个测试\n⏱️ 执行时间: X.X秒\n\n失败的测试：\n1. test_function_name\n   错误：具体错误信息\n   建议：修复建议\n\n测试覆盖率：X%\n```\n\n如果没有找到对应的测试文件，请提示用户创建相应的测试文件。"
  }
}