{
  "enabled": true,
  "name": "ç°ä»£åŒ–ä»£ç è´¨é‡æ£€æŸ¥",
  "description": "ä½¿ç”¨Ruffã€MyPyå’Œuvçš„ç°ä»£åŒ–Pythonä»£ç è´¨é‡æ£€æŸ¥ç³»ç»Ÿï¼Œä¸MiniCRMé¡¹ç›®çš„å·¥å…·é“¾å®Œå…¨å…¼å®¹",
  "version": "2.0",
  "config": {
    "useRuff": true,
    "useMypy": true,
    "useUv": true,
    "autoFix": true,
    "checkComplexity": true,
    "maxFileLines": 200,
    "warningFileLines": 150
  },
  "when": {
    "type": "fileEdited",
    "patterns": [
      "*.py"
    ]
  },
  "then": {
    "type": "askAgent",
    "prompt": "ğŸ”§ **ç°ä»£åŒ–ä»£ç è´¨é‡æ£€æŸ¥ç³»ç»Ÿ**\n\nä½¿ç”¨MiniCRMé¡¹ç›®é…ç½®çš„ç°ä»£åŒ–å·¥å…·é“¾è¿›è¡Œä»£ç è´¨é‡æ£€æŸ¥å’Œä¿®å¤ã€‚\n\n## å·¥å…·é“¾é…ç½®\n\n### 1. Ruff (è¶…å¿«é€ŸLinter + Formatter)\n- **åŠŸèƒ½**: ä»£ç æ£€æŸ¥ã€æ ¼å¼åŒ–ã€å¯¼å…¥æ’åº\n- **é…ç½®**: pyproject.tomlä¸­çš„[tool.ruff]é…ç½®\n- **ä¼˜åŠ¿**: æ¯”ä¼ ç»Ÿå·¥å…·å¿«10-100å€ï¼Œé›†æˆå¤šç§å·¥å…·åŠŸèƒ½\n\n### 2. MyPy (é™æ€ç±»å‹æ£€æŸ¥)\n- **åŠŸèƒ½**: ç±»å‹æ³¨è§£æ£€æŸ¥ã€ç±»å‹æ¨æ–­\n- **é…ç½®**: pyproject.tomlä¸­çš„[tool.mypy]é…ç½®\n- **ä¼˜åŠ¿**: å‘ç°è¿è¡Œæ—¶æ‰ä¼šå‡ºç°çš„ç±»å‹é”™è¯¯\n\n### 3. UV (ç°ä»£åŒ…ç®¡ç†)\n- **åŠŸèƒ½**: ä¾èµ–ç®¡ç†ã€è™šæ‹Ÿç¯å¢ƒã€è„šæœ¬æ‰§è¡Œ\n- **é…ç½®**: pyproject.tomlä¸­çš„é¡¹ç›®é…ç½®\n- **ä¼˜åŠ¿**: æé€Ÿä¾èµ–è§£æå’Œå®‰è£…\n\n## æ£€æŸ¥æµç¨‹\n\n### é˜¶æ®µ1: æ–‡ä»¶å¤§å°æ£€æŸ¥\n```python\n# æ£€æŸ¥æ–‡ä»¶è¡Œæ•°\nmax_lines = {{config.maxFileLines}}  # 400è¡Œ\nwarning_lines = {{config.warningFileLines}}  # 300è¡Œ\n\nif file_lines > max_lines:\n    return \"âŒ æ–‡ä»¶è¿‡å¤§ ({file_lines}è¡Œ > {max_lines}è¡Œ)ï¼Œéœ€è¦æ‹†åˆ†\"\nelif file_lines > warning_lines:\n    return \"âš ï¸ æ–‡ä»¶è¾ƒå¤§ ({file_lines}è¡Œ > {warning_lines}è¡Œ)ï¼Œå»ºè®®æ‹†åˆ†\"\n```\n\n### é˜¶æ®µ2: Ruffæ£€æŸ¥å’Œä¿®å¤\n```bash\n# 1. ä»£ç æ£€æŸ¥\nuv run ruff check {file_path} --output-format=github\n\n# 2. è‡ªåŠ¨ä¿®å¤ï¼ˆå¦‚æœå¯ç”¨ï¼‰\nif {{config.autoFix}}:\n    uv run ruff check {file_path} --fix\n    uv run ruff format {file_path}\n```\n\n### é˜¶æ®µ3: MyPyç±»å‹æ£€æŸ¥\n```bash\n# ç±»å‹æ£€æŸ¥\nuv run mypy {file_path} --show-error-codes --show-column-numbers\n```\n\n### é˜¶æ®µ4: å¤æ‚åº¦æ£€æŸ¥\n```python\n# æ£€æŸ¥å‡½æ•°å¤æ‚åº¦\nif {{config.checkComplexity}}:\n    # ä½¿ç”¨Ruffçš„å¤æ‚åº¦è§„åˆ™\n    uv run ruff check {file_path} --select C901,PLR0912,PLR0913,PLR0915\n```\n\n## MiniCRMç‰¹å®šæ£€æŸ¥\n\n### 1. Transfunctionsä½¿ç”¨æ£€æŸ¥\n```python\n# æ£€æŸ¥æ˜¯å¦åº”è¯¥ä½¿ç”¨transfunctions\ncommon_patterns = [\n    \"validate_.*_data\",\n    \"format_.*\",\n    \"calculate_.*\",\n    \"crud_.*_template\"\n]\n\nfor pattern in common_patterns:\n    if re.search(pattern, code) and \"from transfunctions\" not in code:\n        suggestions.append(f\"å»ºè®®ä½¿ç”¨transfunctions.{pattern}\")\n```\n\n### 2. Qtç»„ä»¶æ£€æŸ¥\n```python\n# æ£€æŸ¥Qtç»„ä»¶ä½¿ç”¨è§„èŒƒ\nif \"PySide6\" in imports:\n    # æ£€æŸ¥ä¿¡å·æ§½è¿æ¥\n    # æ£€æŸ¥èµ„æºæ¸…ç†\n    # æ£€æŸ¥çº¿ç¨‹å®‰å…¨\n```\n\n### 3. æ•°æ®åº“æ“ä½œæ£€æŸ¥\n```python\n# æ£€æŸ¥æ•°æ®åº“æ“ä½œè§„èŒƒ\nif \"sqlite3\" in imports or \"sqlalchemy\" in imports:\n    # æ£€æŸ¥SQLæ³¨å…¥é˜²æŠ¤\n    # æ£€æŸ¥äº‹åŠ¡å¤„ç†\n    # æ£€æŸ¥è¿æ¥ç®¡ç†\n```\n\n## è¾“å‡ºæ ¼å¼\n\n### æˆåŠŸæƒ…å†µ\n```\nâœ… ä»£ç è´¨é‡æ£€æŸ¥é€šè¿‡\n\nğŸ“Š æ£€æŸ¥ç»“æœï¼š\n- æ–‡ä»¶å¤§å°: {file_lines}è¡Œ (âœ… ç¬¦åˆæ ‡å‡†)\n- Ruffæ£€æŸ¥: âœ… æ— é—®é¢˜\n- MyPyæ£€æŸ¥: âœ… ç±»å‹æ­£ç¡®\n- å¤æ‚åº¦: âœ… åœ¨åˆç†èŒƒå›´å†…\n\nğŸš€ å»ºè®®ï¼š\n- ä»£ç è´¨é‡è‰¯å¥½ï¼Œç»§ç»­ä¿æŒï¼\n```\n\n### å‘ç°é—®é¢˜æƒ…å†µ\n```\nğŸ”§ å‘ç°ä»£ç è´¨é‡é—®é¢˜\n\nğŸ“Š æ£€æŸ¥ç»“æœï¼š\n- æ–‡ä»¶å¤§å°: {file_lines}è¡Œ (âš ï¸ å»ºè®®æ‹†åˆ†)\n- Ruffæ£€æŸ¥: âŒ å‘ç°Xä¸ªé—®é¢˜\n- MyPyæ£€æŸ¥: âŒ å‘ç°Xä¸ªç±»å‹é”™è¯¯\n- å¤æ‚åº¦: âš ï¸ éƒ¨åˆ†å‡½æ•°å¤æ‚åº¦è¾ƒé«˜\n\nğŸ”§ è‡ªåŠ¨ä¿®å¤é¡¹ï¼š\n[æ˜¾ç¤ºRuffè‡ªåŠ¨ä¿®å¤çš„å†…å®¹]\n\nâŒ éœ€è¦æ‰‹åŠ¨ä¿®å¤ï¼š\n1. ç±»å‹æ³¨è§£é—®é¢˜ï¼š\n   - ç¬¬Xè¡Œï¼šå‡½æ•°ç¼ºå°‘è¿”å›ç±»å‹æ³¨è§£\n   - ç¬¬Yè¡Œï¼šå‚æ•°ç±»å‹ä¸æ˜ç¡®\n\n2. å¤æ‚åº¦é—®é¢˜ï¼š\n   - å‡½æ•° `function_name` (ç¬¬Xè¡Œ)ï¼šå¤æ‚åº¦è¿‡é«˜ï¼Œå»ºè®®æ‹†åˆ†\n\n3. Transfunctionså»ºè®®ï¼š\n   - ç¬¬Xè¡Œï¼šå»ºè®®ä½¿ç”¨ `transfunctions.validate_customer_data`\n   - ç¬¬Yè¡Œï¼šå»ºè®®ä½¿ç”¨ `transfunctions.format_currency`\n\nğŸ› ï¸ ä¿®å¤å‘½ä»¤ï¼š\n```bash\n# è‡ªåŠ¨ä¿®å¤æ ¼å¼é—®é¢˜\nuv run ruff check {file_path} --fix\nuv run ruff format {file_path}\n\n# è¿è¡Œå®Œæ•´æ£€æŸ¥\n./scripts/check-code.sh\n```\n\nğŸ“š å‚è€ƒæ–‡æ¡£ï¼š\n- Ruffé…ç½®: pyproject.toml [tool.ruff]\n- MyPyé…ç½®: pyproject.toml [tool.mypy]\n- é¡¹ç›®æ ‡å‡†: .kiro/steering/minicrm-development-standards.md\n```\n\n## é›†æˆè¯´æ˜\n\n### ä¸Pre-commité›†æˆ\n- æ­¤Hookä¸pre-commit hooksååŒå·¥ä½œ\n- å¼€å‘æ—¶å®æ—¶æ£€æŸ¥ï¼Œæäº¤æ—¶æœ€ç»ˆéªŒè¯\n- é¿å…é‡å¤æ£€æŸ¥ï¼Œæé«˜æ•ˆç‡\n\n### ä¸VS Codeé›†æˆ\n- ä¸VS Codeè®¾ç½®(.vscode/settings.json)å…¼å®¹\n- æ”¯æŒå®æ—¶é”™è¯¯æç¤ºå’Œè‡ªåŠ¨ä¿®å¤\n- ä¿å­˜æ—¶è‡ªåŠ¨æ ¼å¼åŒ–\n\n### ä¸CI/CDé›†æˆ\n- ä¸GitHub Actionså·¥ä½œæµ(.github/workflows/ci.yml)ä¸€è‡´\n- æœ¬åœ°æ£€æŸ¥ä¸CIæ£€æŸ¥æ ‡å‡†ç»Ÿä¸€\n- å‡å°‘CIå¤±è´¥ç‡\n\n## æ‰§è¡Œè¦æ±‚\n\n1. **ä¼˜å…ˆä½¿ç”¨é…ç½®çš„å·¥å…·**ï¼šä¸¥æ ¼ä½¿ç”¨uvã€ruffã€mypy\n2. **éµå¾ªé¡¹ç›®æ ‡å‡†**ï¼šæŒ‰ç…§pyproject.tomlé…ç½®æ‰§è¡Œ\n3. **æä¾›å…·ä½“å»ºè®®**ï¼šä¸ä»…æŒ‡å‡ºé—®é¢˜ï¼Œè¿˜æä¾›è§£å†³æ–¹æ¡ˆ\n4. **æ”¯æŒè‡ªåŠ¨ä¿®å¤**ï¼šèƒ½è‡ªåŠ¨ä¿®å¤çš„é—®é¢˜ç›´æ¥ä¿®å¤\n5. **ä¿æŒä¸€è‡´æ€§**ï¼šä¸å…¶ä»–å¼€å‘å·¥å…·ä¿æŒä¸€è‡´çš„æ£€æŸ¥æ ‡å‡†\n\nè¯·å¼€å§‹æ‰§è¡Œç°ä»£åŒ–ä»£ç è´¨é‡æ£€æŸ¥ã€‚"
  }
}